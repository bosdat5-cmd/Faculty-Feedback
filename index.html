<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Faculty Feedback Form</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body { font-family: 'Poppins', sans-serif; background:#f5f7fb; margin:0; padding:0; display:flex; justify-content:center; min-height:100vh; }
.container { background:#fff; margin:40px auto; padding:30px; border-radius:20px; width:700px; box-shadow:0 6px 25px rgba(0,0,0,0.15);}
h1 { text-align:center; font-size:26px; font-weight:700; background:linear-gradient(90deg,#673ab7,#3f51b5,#2196f3); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:10px; }
h2 { text-align:center; font-size:18px; font-weight:600; color:#444; margin-bottom:20px; }
label { font-weight:500; display:block; margin:8px 0 5px; color:#333; }
input, select { width:100%; padding:10px; border:1px solid #ccc; border-radius:10px; outline:none; font-size:14px; margin-bottom:15px; transition: all 0.3s; }
input:focus, select:focus { border-color:#3f51b5; box-shadow:0 0 6px rgba(63,81,181,0.5); }
.btn { display:inline-block; background:linear-gradient(90deg,#3f51b5,#2196f3); color:#fff; border:none; border-radius:10px; padding:12px 20px; font-size:14px; font-weight:600; cursor:pointer; margin:10px 5px 0 0; transition: all 0.3s; }
.btn:hover { transform: scale(1.07); box-shadow: 0 4px 12px rgba(0,0,0,0.2);}
.form-page { display:none; }
.active-page { display:block; }
.q-card { background:#f8f9ff; padding:15px; border-radius:12px; margin-bottom:15px; border:1px solid #ddd; }
.thankyou { text-align:center; color:#2196f3; font-size:22px; font-weight:700; margin-top:20px; }
</style>
</head>
<body>
<div class="container">
<h1>THE INSTITUTE OF CHARTERED ACCOUNTANTS OF INDIA</h1>
<h2>Faculty Self-Evaluation Form â€“ Chartered Accountancy Educators</h2>

<!-- ================= PAGE 1: BASIC INFO ================= -->
<div class="form-page active" id="page1">
  <h2 class="text-lg font-semibold mb-4">Basic Information</h2>

  <!-- Student Name -->
  <input name="studentName" id="studentName" placeholder="Student Name" 
         class="w-full border p-2 rounded mb-2" required>

  <!-- Registration Number -->
  <input name="regNumber" id="regNumber" placeholder="Registration Number" 
         class="w-full border p-2 rounded mb-2" required>

  <!-- Region Dropdown -->
  <label for="region" class="block font-medium mt-2">Select Region</label>
  <select id="region" name="region" class="w-full border p-2 rounded mb-2" required>
    <option value="">-- Select Region --</option>
    <option value="CIRC">CIRC</option>
    <option value="NIRC">NIRC</option>
    <option value="EIRC">EIRC</option>
    <option value="SIRC">SIRC</option>
    <option value="WIRC">WIRC</option>
  </select>

  <!-- Branch Dropdown -->
  <label for="branch" class="block font-medium mt-2">Select Branch</label>
  <select id="branch" name="branch" class="w-full border p-2 rounded mb-2" required>
    <option value="">-- Select Branch --</option>
  </select>
</div>

<script>
  // Region -> Branches mapping
  const regionBranches = {
    "CIRC": [
      "Agra","Ajmer","Aligarh","Alwar","Bareilly","Beawar","Bhagalpur","Bharatpur","Bhilwara",
      "Bhopal","Bikaner","Bilaspur","Bulandshahr","Chittorgarh","Darbhanga","Dehradun","Dhanbad",
      "Gautam Budh Nagar","Ghaziabad","Gorakhpur","Gwalior","Haldwani","Hanumangarh","Haridwar",
      "Bhilai","Indore","Jabalpur","Jaipur","Jamshedpur","Jhansi","Jodhpur","Kishangarh","Kota",
      "Lucknow","Mandsaur","Mathura","Meerut","Moradabad","Muzaffarnagar","Muzaffarpur","Neemuch",
      "Pali","Patna","Prayagraj","Raigarh","Raipur","Rajsamand","Ranchi","Ratlam","Saharanpur",
      "Satna","Sikar","Sriganganagar","Tonk","Udaipur","Ujjain","Varanasi"
    ],
    "EIRC": [
      "Asansol","Bhubaneswar","Brahmapur","Cuttack","Dibrugarh","Durgapur","Eirc","Guwahati",
      "Jharsuguda","Raniganj","Rourkela","Sambalpur","Siliguri","Tinsukia"
    ],
    "NIRC": [
      "Ambala","Amritsar","Bahadurgarh","Bathinda","Bhiwani","Chandigarh","Faridabad","Gurugram",
      "Himachal Pradesh","Hisar","Jalandhar","Jammu And Kashmir","Kaithal","Karnal","Kurukshetra",
      "Ludhiana","Mandi Gobindgarh","Panipat","Patiala","Rewari","Rohtak","Sangrur","Sirsa",
      "Sonepat","Yamunanagar"
    ],
    "SIRC": [
      "Alappuzha","Anantapur","Ballari","Belagavi","Bengaluru","Chengalpattu","Coimbatore",
      "Ernakulam","Erode","Guntur","Hubballi","Hyderabad","Kadapa","Kakinada","Kalaburagi",
      "Kannur","Karimnagar","Kollam","Kottayam","Kozhikode","Kumbakonam","Kurnool","Madurai",
      "Mangaluru","Mysuru","Nellore","Ongole","Palakkad","Puducherry","Rajamahendravaram","Salem",
      "Sivakasi","Thiruvananthapuram","Thoothukudi","Thrissur","Tiruchirapalli","Tirunelveli",
      "Tirupati","Tirupur","Udupi","Vellore","Vijayawada","Visakhapatnam","Vizianagaram","Warangal",
      "West Godavari"
    ],
    "WIRC": [
      "Ahmedabad","Ahmednagar","Akola","Amravati","Anand","Bharuch","Bhavnagar","Bhuj",
      "Chhatrapati Sambhajinagar (Aurangabad)","Dhule","Gandhidham","Gandhinagar","Goa",
      "Ichalkaranji","Jalgaon","Jamnagar","Kalyan Dombivli","Kolhapur","Latur","Nagpur","Nanded",
      "Nashik","Navi Mumbai","Navsari","Pimpri Chinchwad","Pune","Rajkot","Ratnagiri","Sangli",
      "Satara","Solapur","Surat","Thane","Vadodara","Vapi","Vasai"
    ]
  };

  // Populate branches when region changes
  document.getElementById("region").addEventListener("change", function() {
    const branchSelect = document.getElementById("branch");
    branchSelect.innerHTML = '<option value="">-- Select Branch --</option>'; // reset

    const selectedRegion = this.value;
    if (regionBranches[selectedRegion]) {
      regionBranches[selectedRegion].forEach(branch => {
        const option = document.createElement("option");
        option.value = branch;
        option.textContent = branch;
        branchSelect.appendChild(option);
      });
    }
  });
</script>
<!-- Page 2: Select SRN -->
<div id="page2" class="form-page">
  <label>Select Student SRN *</label>
  <select id="srnDropdown"></select>

  <div style="text-align:right;">
    <button class="btn" onclick="goToQuestions()">Next â†’</button>
  </div>
</div>

<!-- Page 3: Feedback Questions -->
<div id="page3" class="form-page">
  <div id="questionsContainer"></div>
  <div style="text-align:right;">
    <button class="btn" onclick="submitFeedback()">Submit âœ…</button>
  </div>
</div>

<!-- Page 4: Thank You -->
<div id="page4" class="form-page">
  <p class="thankyou">ðŸŽ‰ All feedback submitted successfully!</p>
</div>

</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxA3DQGfZaXgO6KkD6-aMBL9kVmGLqmOObN6kja1cA0iwBxSPZ0IJxFQHgWEzjxvS6ZEA/exec"; // âœ… Replace with deployed Apps Script URL

let students = [];
let completedSRNs = [];
let currentSRN = null;
let facultyInfo = {};

const questions = [
  "Subject Knowledge","Session Planning","Communication Skills","Engagement & Interaction",
  "Innovative Methods","Time Management","Adherence to Guidelines","Response to Questions",
  "Practical Examples","Professional Conduct","Use of Technology","Classroom Discipline",
  "Student Feedback","Contribution to Growth","Overall Impact","Mindset Transformation Facilitation",
  "Student-Centric Approach","Feedback Incorporation","Contribution to Faculty Development",
  "Ethical Leadership & Role Modelling"
];

// ðŸ“¥ Download template
function downloadTemplate(){
  const ws_data=[["S.No","SRN","Name"],["1","SRN001","John Doe"]];
  const ws=XLSX.utils.aoa_to_sheet(ws_data);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Template");
  XLSX.writeFile(wb,"StudentTemplate.xlsx");
}

// ðŸ“¤ Upload Excel
function uploadExcel(event){
  const file=event.target.files[0];
  if(!file){ alert("âš  Please select an Excel file"); return; }
  const reader=new FileReader();
  reader.onload=(e)=>{
    const data=new Uint8Array(e.target.result);
    const workbook=XLSX.read(data,{type:"array"});
    const sheet=workbook.Sheets[workbook.SheetNames[0]];
    students=XLSX.utils.sheet_to_json(sheet);
    if(students.length===0){ alert("âš  Excel file is empty or invalid"); }
  };
  reader.readAsArrayBuffer(file);
}

// ðŸ‘‰ Page navigation
function showPage(n){
  document.querySelectorAll(".form-page").forEach(p=>p.style.display="none");
  document.getElementById("page"+n).style.display="block";
}

// ðŸ‘‰ Go to SRN selection
function goToSRN(){
  const name=document.getElementById("facultyName").value.trim();
  const reg=document.getElementById("regNumber").value.trim();
  const mobile=document.getElementById("mobileNo").value.trim();
  const email=document.getElementById("email").value.trim();

  if(!name||!reg||!mobile||!email){ alert("âš  Please fill all fields"); return; }
  if(students.length===0){ alert("âš  Please upload student Excel file first"); return; }

  facultyInfo={facultyName:name,regNumber:reg,mobileNo:mobile,email:email};
  updateSRNDropdown();
  showPage(2);
}

// ðŸ‘‰ Populate SRN dropdown excluding completed
function updateSRNDropdown(){
  const dropdown=document.getElementById("srnDropdown");
  dropdown.innerHTML="";
  const remaining=students.filter(s=>!completedSRNs.includes(s.SRN));
  if(remaining.length===0){ showPage(4); return; }
  remaining.forEach(s=>{
    dropdown.innerHTML+=`<option value="${s.SRN}">${s.SRN} - ${s.Name}</option>`;
  });
}

// ðŸ‘‰ Go to Feedback Questions
function goToQuestions(){
  const dropdown=document.getElementById("srnDropdown");
  if(!dropdown.value){ alert("âš  Please select SRN"); return; }
  currentSRN=dropdown.value;
  loadQuestions();
  showPage(3);
}

// ðŸ‘‰ Load questions
function loadQuestions(){
  const container=document.getElementById("questionsContainer");
  container.innerHTML="";
  questions.forEach((q,i)=>{
    container.innerHTML+=`
      <div class="q-card">
        <label>${q}</label>
        <select name="q${i}">
          <option value="">-- Select --</option>
          <option value="1">Poor</option>
          <option value="2">Below Average</option>
          <option value="3">Average</option>
          <option value="4">Good</option>
          <option value="5">Excellent</option>
        </select>
      </div>`;
  });
}

// âœ… Submit feedback with FormData
async function submitFeedback(){
  const ratings=[];
  questions.forEach((q,i)=>{
    const sel=document.querySelector(`select[name="q${i}"]`);
    ratings.push(sel.value || "");
  });

  const payload = {
    facultyName: facultyInfo.facultyName,
    mobile: facultyInfo.mobileNo,
    email: facultyInfo.email,
    batchId: "",
    region: "",
    branch: "",
    day: new Date().toLocaleDateString(),
    srn: currentSRN,
    score: "",
    grade: ""
  };

  ratings.forEach((val,i)=>{
    payload[`Q${i+1}`] = val;
  });

  try{
    const res = await fetch("https://script.google.com/macros/s/AKfycbxA3DQGfZaXgO6KkD6-aMBL9kVmGLqmOObN6kja1cA0iwBxSPZ0IJxFQHgWEzjxvS6ZEA/exec", {
      method:"POST",
      body: JSON.stringify(payload),
      headers: { "Content-Type": "application/json" }
    });
    const result = await res.json();

    if(result.result === "success"){
      alert("âœ… Feedback submitted successfully");
      completedSRNs.push(currentSRN);
      updateSRNDropdown();
      if(completedSRNs.length===students.length){ 
        showPage(4); 
      } else { 
        showPage(2); 
      }
    }else{
      alert("âš  Error: "+(result.message||"Unable to submit feedback"));
    }
  }catch(err){
    console.error(err);
    alert("Error submitting feedback: "+err.message);
  }
}
</script>
</body>
</html>

