<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Faculty Feedback Form</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background: #f9f9f9; margin:0; padding:0; }
    .container { max-width: 700px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2, h3 { text-align: center; color:#0077b6; }
    label { display:block; margin-top:10px; font-weight:600; }
    input, select { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:6px; }
    .btn { background:#0077b6; color:white; padding:10px 15px; margin-top:15px; border:none; border-radius:6px; cursor:pointer; }
    .btn:hover { background:#023e8a; }
    .form-page { display:none; }
    .active-page { display:block; }
    .quote-box { background:#f1f1f1; padding:15px; margin-top:15px; border-radius:8px; text-align:center; font-style:italic; }
  </style>
</head>
<body>
<div class="container">
  <h2>THE INSTITUTE OF CHARTERED ACCOUNTANTS OF INDIA</h2>
  <h3>Faculty Feedback Form</h3>

  <!-- Page 1 -->
  <div class="form-page active-page" id="page1">
    <h3>Basic Details</h3>
    <label>Faculty Name:</label>
    <input type="text" id="facultyName" required>
    <label>Mobile Number:</label>
    <input type="text" id="mobileNumber" required>
    <label>Email ID:</label>
    <input type="email" id="emailId" required>
    <label>Batch ID:</label>
    <input type="text" id="batchId" required>

    <label>Region:</label>
    <select id="regionSelect" onchange="updateBranches()" required>
      <option value="">-- Select Region --</option>
      <option value="CIRC">CIRC</option>
      <option value="EIRC">EIRC</option>
      <option value="NIRC">NIRC</option>
      <option value="SIRC">SIRC</option>
      <option value="WIRC">WIRC</option>
      <option value="FRO">FRO</option>
    </select>

    <label>Branch:</label>
    <select id="branchSelect" required>
      <option value="">-- Select Branch --</option>
    </select>

    <h3>Select Day</h3>
    <label>Day:</label>
    <select id="lockDaySelect" required>
      <option value="">-- Select Day --</option>
    </select>

    <h3>Student Data</h3>
    <button class="btn" type="button" onclick="downloadTemplate()">ðŸ“¥ Download Excel Template</button>
    <label>Upload Student Data File:</label>
    <input type="file" id="excelFile" accept=".xlsx, .xls" onchange="handleFileUpload(event)">

    <button class="btn" type="button" onclick="startFeedback()">âž¡ Start Feedback</button>
  </div>

  <!-- Page 2 -->
  <div class="form-page" id="page2">
    <h3>Session Feedback</h3>
    <label>Day:</label>
    <select id="daySelect" disabled></select>

    <label>Student SRN:</label>
    <select id="uniqueKeySelect">
      <option value="">-- Select SRN --</option>
    </select>

    <button class="btn" type="button" onclick="showPage(1)">â¬… Back</button>
    <button class="btn" type="button" onclick="startSRNFeedback()">âœ… Next</button>
  </div>

  <!-- Page 3 -->
  <div class="form-page" id="page3">
    <h2 id="feedbackHeading">Feedback Questions</h2>
    <div id="questionsContainer"></div>
    <div id="resultBox">
      <p>Score: <span id="finalScore">0</span></p>
      <p>Grade: <span id="finalGrade">-</span></p>
    </div>
    <button class="btn" type="button" onclick="prevPage3()">â¬… Previous SRN</button>
    <button class="btn" type="button" onclick="submitFeedback()">Submit Feedback</button>
  </div>

  <!-- Page 4 -->
  <div class="form-page" id="page4">
    <h2>Thank You!</h2>
    <p>Your feedback has been successfully submitted.</p>
    <div class="quote-box">
      <p id="dailyQuote"></p>
    </div>
  </div>
</div>

<script>
const webAppURL = "YOUR_GOOGLE_SCRIPT_DEPLOYED_URL";  // replace this with your Apps Script Web App URL

// --- Branches per Region ---
const branches = {
  "CIRC":["Agra","Allahabad","Kanpur"],
  "EIRC":["Kolkata","Patna","Guwahati"],
  "NIRC":["Delhi","Jaipur","Chandigarh"],
  "SIRC":["Chennai","Bangalore","Hyderabad"],
  "WIRC":["Mumbai","Pune","Nagpur"],
  "FRO":["Dubai","Doha"]
};

function updateBranches(){
  const region=document.getElementById("regionSelect").value;
  const branchSelect=document.getElementById("branchSelect");
  branchSelect.innerHTML='<option value="">-- Select Branch --</option>';
  if(branches[region]){
    branches[region].forEach(b=>{
      const opt=document.createElement("option");
      opt.value=b;
      opt.textContent=b;
      branchSelect.appendChild(opt);
    });
  }
}
function populateDayDropdown(){
  const daySel=document.getElementById("lockDaySelect");
  for(let i=1;i<=15;i++){
    const opt=document.createElement("option");
    opt.value="Day "+i;
    opt.textContent="Day "+i;
    daySel.appendChild(opt);
  }
}

// --- Download Template ---
function downloadTemplate(){
  const ws=XLSX.utils.aoa_to_sheet([["SRN","Name"]]);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Students");
  XLSX.writeFile(wb,"StudentTemplate.xlsx");
}

// --- Upload Excel ---
function handleFileUpload(e){
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=(evt)=>{
    const data=new Uint8Array(evt.target.result);
    const workbook=XLSX.read(data,{type:"array"});
    const firstSheet=workbook.Sheets[workbook.SheetNames[0]];
    const rows=XLSX.utils.sheet_to_json(firstSheet,{header:1});
    const srnSel=document.getElementById("uniqueKeySelect");
    srnSel.innerHTML='<option value="">-- Select SRN --</option>';
    rows.slice(1).forEach(r=>{
      if(r[0]){
        const opt=document.createElement("option");
        opt.value=r[0];
        opt.textContent=r[0]+" - "+(r[1]||"");
        srnSel.appendChild(opt);
      }
    });
  };
  reader.readAsArrayBuffer(file);
}

// --- Navigation ---
function showPage(n){
  document.querySelectorAll(".form-page").forEach(p=>p.classList.remove("active-page"));
  document.getElementById("page"+n).classList.add("active-page");
}

// --- Start Feedback ---
function startFeedback(){
  const selectedDay=document.getElementById("lockDaySelect").value;
  if(!selectedDay){alert("Please select a Day first."); return;}
  const daySel=document.getElementById("daySelect");
  daySel.innerHTML=`<option>${selectedDay}</option>`;
  showPage(2);
}

// --- Start SRN Feedback ---
function startSRNFeedback(){
  const srn=document.getElementById("uniqueKeySelect").value;
  if(!srn){alert("Please select SRN"); return;}
  showPage(3);
}

// --- Example Questions ---
function renderQuestions(){
  const qc=document.getElementById("questionsContainer");
  qc.innerHTML="";
  ["Clarity of Teaching","Interaction","Subject Knowledge"].forEach((q,i)=>{
    const div=document.createElement("div");
    div.innerHTML=`<label>${q}:</label>
      <select class="question" data-q="${q}">
        <option value="">-- Select --</option>
        <option value="5">Excellent</option>
        <option value="4">Good</option>
        <option value="3">Average</option>
        <option value="2">Poor</option>
        <option value="1">Very Poor</option>
      </select>`;
    qc.appendChild(div);
  });
}

// --- Submit Feedback ---
async function submitFeedback(){
  const faculty=document.getElementById("facultyName").value;
  const mobile=document.getElementById("mobileNumber").value;
  const email=document.getElementById("emailId").value;
  const batch=document.getElementById("batchId").value;
  const region=document.getElementById("regionSelect").value;
  const branch=document.getElementById("branchSelect").value;
  const day=document.getElementById("daySelect").value;
  const srn=document.getElementById("uniqueKeySelect").value;

  const responses=[...document.querySelectorAll(".question")].map(sel=>({q:sel.dataset.q,a:sel.value}));

  const payload={faculty,mobile,email,batch,region,branch,day,srn,responses};

  try{
    const resp=await fetch(webAppURL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    if(!resp.ok) throw new Error("Network error");
    showPage(4);
    showDailyQuote();
  }catch(err){
    alert("Submission failed: "+err.message);
  }
}

// --- Daily Quote ---
function showDailyQuote(){
  const quotes=[
    "Success is not final, failure is not fatal: it is the courage to continue that counts.",
    "The best way to predict the future is to create it.",
    "Dream big. Start small. Act now.",
    "Believe you can and you're halfway there.",
    "Push yourself, because no one else is going to do it for you.",
    "Great things never come from comfort zones."
  ];
  const today=new Date().getDate();
  document.getElementById("dailyQuote").innerText=quotes[today%quotes.length];
}

// --- Init ---
document.addEventListener("DOMContentLoaded",()=>{
  renderQuestions();
  populateDayDropdown();
});
</script>
</body>
</html>
