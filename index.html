<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Faculty Feedback Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f7fb;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      background: #fff;
      margin: 40px auto;
      padding: 30px;
      border-radius: 20px;
      width: 700px;
      box-shadow: 0 6px 25px rgba(0,0,0,0.15);
    }
    h1 {
      text-align: center;
      font-size: 26px;
      font-weight: 700;
      background: linear-gradient(90deg, #673ab7, #3f51b5, #2196f3);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }
    h2 {
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      color: #444;
      margin-bottom: 20px;
    }
    label {
      font-weight: 500;
      display: block;
      margin: 8px 0 5px;
      color: #333;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      outline: none;
      font-size: 14px;
      margin-bottom: 15px;
      transition: all 0.3s;
    }
    input:focus, textarea:focus, select:focus {
      border-color: #3f51b5;
      box-shadow: 0 0 6px rgba(63,81,181,0.5);
    }
    .btn {
      display: inline-block;
      background: linear-gradient(90deg,#3f51b5,#2196f3);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin: 10px 5px 0 0;
      transition: all 0.3s;
    }
    .btn:hover {
      transform: scale(1.07);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .form-page { display: none; }
    .active-page { display: block; }
    .q-card {
      background: #f8f9ff;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
    }
    .radio-option {
      margin: 4px 0;
    }
    .thankyou {
      text-align: center;
      color: #2196f3;
      font-size: 22px;
      font-weight: 700;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <div class="container">

    <h1>THE INSTITUTE OF CHARTERED ACCOUNTANTS OF INDIA</h1>
    <h2>Faculty Self-Evaluation Form â€“ Chartered Accountancy Educators</h2>

    <!-- Page 0 (Upload Excel + SRN selection) -->
    <div id="page0" class="form-page active-page">
      <label>ðŸ“¥ Download Template</label>
      <button class="btn" onclick="downloadTemplate()">Download Excel Template</button>

      <label>ðŸ“¤ Upload Student Excel</label>
      <input type="file" id="excelFile" accept=".xlsx" onchange="uploadExcel(event)">

      <label>Select SRN for Feedback *</label>
      <select id="srnDropdown"></select>

      <div style="text-align:right;">
        <button type="button" class="btn" onclick="startFeedback()">Start â†’</button>
      </div>
    </div>

    <!-- Page 1 (Feedback Questions) -->
    <div id="page1" class="form-page">
      <div id="questionsContainer"></div>
      <div style="text-align:right;">
        <button type="button" class="btn" onclick="submitFeedback()">Submit âœ…</button>
      </div>
    </div>

    <!-- Page 2 (Thank You / Next SRN) -->
    <div id="page2" class="form-page">
      <p class="thankyou">ðŸŽ‰ Feedback submitted successfully!</p>
      <button class="btn" onclick="nextStudent()">âž¡ Next Student</button>
    </div>

  </div>

<script>
let students = [];
let currentSRN = null;

// Download Excel template
function downloadTemplate() {
  const ws_data = [["S.No", "SRN", "Name"], ["1", "SRN001", "John Doe"]];
  const ws = XLSX.utils.aoa_to_sheet(ws_data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Template");
  XLSX.writeFile(wb, "StudentTemplate.xlsx");
}

// Upload Excel
function uploadExcel(event) {
  const file = event.target.files[0];
  const reader = new FileReader();
  reader.onload = (e) => {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: "array" });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    students = XLSX.utils.sheet_to_json(sheet);

    let dropdown = document.getElementById("srnDropdown");
    dropdown.innerHTML = "";
    students.forEach(s => {
      if(s.SRN) dropdown.innerHTML += `<option value="${s.SRN}">${s.SRN} - ${s.Name}</option>`;
    });
  };
  reader.readAsArrayBuffer(file);
}

// Start feedback
function startFeedback() {
  const dropdown = document.getElementById("srnDropdown");
  if(!dropdown.value) { alert("âš  Please select an SRN"); return; }
  currentSRN = dropdown.value;
  loadQuestions();
  showPage(1);
}

// Load questions
function loadQuestions() {
  const container = document.getElementById("questionsContainer");
  container.innerHTML = "";

  const questions = [
    "Subject Knowledge",
    "Session Planning",
    "Communication Skills",
    "Engagement & Interaction",
    "Innovative Methods",
    "Time Management",
    "Adherence to Guidelines",
    "Response to Questions",
    "Practical Examples",
    "Professional Conduct",
    "Use of Technology",
    "Classroom Discipline",
    "Student Feedback",
    "Contribution to Growth",
    "Overall Impact",
    "Mindset Transformation Facilitation",
    "Student-Centric Approach",
    "Feedback Incorporation",
    "Contribution to Faculty Development",
    "Ethical Leadership & Role Modelling"
  ];

  questions.forEach((q, i) => {
    container.innerHTML += `
      <div class="q-card">
        <label>${q}</label>
        <div class="radio-option"><input type="radio" name="q${i}" value="1"> Poor</div>
        <div class="radio-option"><input type="radio" name="q${i}" value="2"> Below Average</div>
        <div class="radio-option"><input type="radio" name="q${i}" value="3"> Average</div>
        <div class="radio-option"><input type="radio" name="q${i}" value="4"> Good</div>
        <div class="radio-option"><input type="radio" name="q${i}" value="5"> Excellent</div>
      </div>`;
  });
}

// Submit feedback
function submitFeedback() {
  // All questions are optional now, so we don't validate
  // mark SRN as completed
  students = students.filter(s => s.SRN !== currentSRN);
  showPage(2);
}

// Next student
function nextStudent() {
  if(students.length === 0){
    alert("âœ… All student feedback completed!");
    showPage(0);
    document.getElementById("srnDropdown").innerHTML = "";
    return;
  }
  let dropdown = document.getElementById("srnDropdown");
  dropdown.innerHTML = "";
  students.forEach(s => {
    if(s.SRN) dropdown.innerHTML += `<option value="${s.SRN}">${s.SRN} - ${s.Name}</option>`;
  });
  showPage(0);
}

// Show page
function showPage(n) {
  document.querySelectorAll(".form-page").forEach(p => p.style.display = "none");
  document.getElementById("page"+n).style.display = "block";
}
</script>
</body>
</html>
