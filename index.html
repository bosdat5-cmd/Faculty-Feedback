<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Faculty Feedback Form</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #0077b6, #00b4d8); margin:0; padding:0; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; }
.container { background:#fff; margin-top:40px; padding:30px; border-radius:15px; width:500px; box-shadow:0 6px 20px rgba(0,0,0,0.15); animation:fadeIn 0.5s ease-in-out; }
h2 { text-align:center; color:#023e8a; margin-bottom:20px; font-weight:600; }
h3 { color:#0077b6; margin-bottom:15px; }
label { font-weight:500; display:block; margin:8px 0 5px; color:#333; }
input, select { width:100%; padding:10px; border:1px solid #ccc; border-radius:10px; outline:none; font-size:14px; margin-bottom:15px; transition:all 0.3s; }
input:focus, select:focus { border-color:#00b4d8; box-shadow:0 0 6px rgba(0,180,216,0.5); }
.btn { display:inline-block; background:#0077b6; color:#fff; border:none; border-radius:10px; padding:10px 18px; font-size:14px; font-weight:500; cursor:pointer; margin:5px 5px 0 0; transition:all 0.3s; }
.btn:hover { background:#023e8a; transform:scale(1.05); }
.form-page { display:none; }
.active-page { display:block; }
.quote-box { background:#f1faff; padding:20px; border-left:5px solid #00b4d8; margin-top:20px; border-radius:10px; font-style:italic; color:#333; }
@keyframes fadeIn { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
</style>
</head>
<body>
<div class="container">
  <h2>THE INSTITUTE OF CHARTERED ACCOUNTANTS OF INDIA</h2>
  <h3 style="text-align:center; color:#0077b6;">Faculty Feedback Form</h3>

  <!-- Page 1 -->
  <div class="form-page active-page" id="page1">
    <h3>Basic Details</h3>
    <label>Faculty Name:</label>
    <input type="text" id="facultyName" placeholder="Enter faculty name" required>
    <label>Mobile Number:</label>
    <input type="text" id="mobileNumber" placeholder="10-digit mobile" required>
    <label>Email ID:</label>
    <input type="email" id="emailId" placeholder="example@email.com" required>
    <label>Batch ID:</label>
    <input type="text" id="batchId" placeholder="Enter batch ID" required>

    <h3>Select Day for Feedback</h3>
    <label>Day:</label>
    <select id="lockDaySelect" required>
      <option value="">-- Select Day --</option>
    </select>

    <h3>Student Data</h3>
    <button class="btn" onclick="downloadTemplate()">ðŸ“¥ Download Excel Template</button>
    <label>Upload Student Data File:</label>
    <input type="file" id="excelFile" accept=".xlsx, .xls" onchange="handleFileUpload(event)">

    <button class="btn" onclick="nextPage1()">âž¡ Next</button>
  </div>

  <!-- Page 2 -->
  <div class="form-page" id="page2">
    <h3>Session Feedback</h3>
    <label>Day:</label>
    <select id="daySelect"></select>

    <label>Student Unique Key (SRN):</label>
    <select id="uniqueKeySelect">
      <option value="">-- Select SRN --</option>
    </select>

    <button class="btn" onclick="prevPage()">â¬… Back</button>
    <button class="btn" onclick="nextPage()">âœ… Next</button>
  </div>

  <!-- Page 3 -->
  <div class="form-page" id="page3">
    <h2 class="text-xl font-semibold mb-4 text-center">Feedback Questions</h2>
    <div id="questionsContainer"></div>
    <div id="resultBox" class="mt-6 p-4 border rounded bg-gray-100">
      <p>Score: <span id="finalScore">0</span></p>
      <p>Grade: <span id="finalGrade">-</span></p>
    </div>
    <button class="btn" onclick="prevPage()">â¬… Back</button>
    <button class="btn" onclick="submitForm()">Submit</button>
  </div>

  <!-- Page 4 -->
  <div class="form-page" id="page4">
    <div class="text-center p-6">
      <h2>Thank You!</h2>
      <p>Your feedback has been successfully submitted.</p>
      <div class="quote-box">
        <p id="dailyQuote"></p>
      </div>
    </div>
  </div>
</div>

<script>
let currentPage = 1;
let srnListGlobal = [];
let lockedDay = ""; // Will lock only after first feedback
const questions = [
  "Subject knowledge","Session planning & structure","Communication skills",
  "Engagement & interaction","Innovative methods","Time management",
  "Adherence to guidelines","Response to questions","Practical examples",
  "Professional conduct","Technology use","Discipline",
  "Student feedback","Contribution to growth","Overall impact"
];

// Populate day dropdown for Page 1
function populateDayDropdown() {
  const daySelect = document.getElementById("lockDaySelect");
  for(let i=1;i<=15;i++){
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = "Day " + i;
    daySelect.appendChild(opt);
  }
}

// Render Questions
function renderQuestions() {
  const container = document.getElementById("questionsContainer");
  container.innerHTML = "";
  questions.forEach((q, i) => {
    const block = document.createElement("div");
    block.innerHTML = `<label>${i+1}. ${q}</label>
    <select class="ratingSelect" required>
      <option value="">-- Select Rating --</option>
      <option value="20">1 - Poor (20)</option>
      <option value="40">2 - Below Average (40)</option>
      <option value="60">3 - Average (60)</option>
      <option value="80">4 - Good (80)</option>
      <option value="100">5 - Excellent (100)</option>
    </select>`;
    container.appendChild(block);
  });
  document.querySelectorAll(".ratingSelect").forEach(sel => sel.addEventListener("change", updateLiveScore));
}

// Update live score
function updateLiveScore() {
  const selects = document.querySelectorAll(".ratingSelect");
  let total = 0, count = 0;
  selects.forEach(sel => { if(sel.value){ total += parseInt(sel.value); count++; }});
  const avg = count ? total / count : 0;
  document.getElementById("finalScore").innerText = avg.toFixed(2);
  let grade = "-";
  if(avg >= 85) grade="A+"; else if(avg >=70) grade="A"; else if(avg >=50) grade="B+"; else if(avg >=30) grade="B"; else if(avg>0) grade="C";
  document.getElementById("finalGrade").innerText = grade;
}

// Navigation
function nextPage() {
  document.getElementById("page"+currentPage).classList.remove("active-page");
  currentPage++;
  document.getElementById("page"+currentPage).classList.add("active-page");
}
function prevPage() {
  document.getElementById("page"+currentPage).classList.remove("active-page");
  currentPage--;
  document.getElementById("page"+currentPage).classList.add("active-page");
}

// Page 1 Next
function nextPage1() {
  if(!srnListGlobal.length){ alert("Upload student data first"); return; }

  const selectedDay = document.getElementById("lockDaySelect").value;
  if(!selectedDay){ alert("Select a day"); return; }

  const dayDropdown = document.getElementById("daySelect");
  dayDropdown.innerHTML = `<option value="${selectedDay}">Day ${selectedDay}</option>`;
  dayDropdown.disabled = false; // still editable

  nextPage();
}

// Excel template
function downloadTemplate() {
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet([["S.No","SRN","Name"]]);
  XLSX.utils.book_append_sheet(wb, ws, "Template");
  XLSX.writeFile(wb,"Student_Template.xlsx");
}

// Handle file upload
function handleFileUpload(event) {
  const file = event.target.files[0];
  const reader = new FileReader();

  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data,{type:"array"});
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const jsonData = XLSX.utils.sheet_to_json(sheet,{header:1});

    srnListGlobal = [];
    for(let i=1;i<jsonData.length;i++) {
      if(jsonData[i][1]){
        srnListGlobal.push({ value: jsonData[i][1], completed: false });
      }
    }
    populateSRNDropdown();
    alert("âœ… Student SRNs loaded!");
  }

  reader.readAsArrayBuffer(file);
}

// Populate SRN dropdown
function populateSRNDropdown() {
  const dropdown = document.getElementById("uniqueKeySelect");
  dropdown.innerHTML = '<option value="">-- Select SRN --</option>';
  srnListGlobal.forEach(srn => {
    if(!srn.completed){
      const opt = document.createElement("option");
      opt.value = srn.value;
      opt.textContent = srn.value;
      dropdown.appendChild(opt);
    }
  });
}

// Submit feedback
function submitForm() {
  const selectedSRN = document.getElementById("uniqueKeySelect").value;
  if(!selectedSRN){ alert("Select SRN"); return; }

  // Lock day after first feedback
  const dayDropdown = document.getElementById("daySelect");
  if(!lockedDay){ 
    lockedDay = dayDropdown.value;
    dayDropdown.disabled = true; // lock now
  }

  srnListGlobal = srnListGlobal.map(srn => srn.value === selectedSRN ? { ...srn, completed:true } : srn );
  populateSRNDropdown();

  document.querySelectorAll(".ratingSelect").forEach(sel=>sel.value="");

  if(srnListGlobal.some(s => !s.completed)) {
    document.getElementById("page"+currentPage).classList.remove("active-page");
    currentPage = 2;
    document.getElementById("page"+currentPage).classList.add("active-page");
    alert(`âœ… Feedback submitted for SRN: ${selectedSRN}`);
  } else {
    document.getElementById("page"+currentPage).classList.remove("active-page");
    currentPage = 4;
    document.getElementById("page"+currentPage).classList.add("active-page");
    showDailyQuote();
  }
}

// Daily Quote
function showDailyQuote() {
  const quotes = [
    "Success is not final, failure is not fatal: it is the courage to continue that counts.",
    "The best way to predict the future is to create it.",
    "Dream big. Start small. Act now.",
    "Believe you can and you're halfway there.",
    "Push yourself, because no one else is going to do it for you.",
    "Great things never come from comfort zones."
  ];
  const today = new Date().getDate();
  document.getElementById("dailyQuote").innerText = quotes[today%quotes.length];
}

// Initialize
document.addEventListener("DOMContentLoaded", () => {
  renderQuestions();
  populateDayDropdown();
});
</script>
</body>
</html>
